var app=angular.module("rs-auth",[]).constant("AUTH_EVENTS",{loginSuccess:"auth-login-success",loginFailed:"auth-login-failed",logoutSuccess:"auth-logout-success",sessionTimeout:"auth-session-timeout",notAuthenticated:"auth-not-authenticated",notAuthorized:"auth-not-authorized"}),app=angular.module("rs-auth",[]),app=angular.module("rs-auth");app.provider("$rsAuth",function(){var t={apiPrefix:""},e={all:"*",member:"user-member",visitor:"user-visitor"};this.setConfig=function(e){e.apiPrefix&&(t.apiPrefix=e.apiPrefix)},this.setUserRoles=function(t){e=t},this.$get=function(n,s){return{login:function(e,o){return n({url:t.apiPrefix+e,method:"POST",data:o}).then(function(t){return o.remember&&s.setLocalAuth(t.data.token),s.set("authToken",t.data.token),s.set("userRole",t.data.user.status),s.setUser(t.data.user),t})},logout:function(e){return n({url:t.apiPrefix+e,method:"GET",headers:{"X-Auth-Token":s.get("authToken")}}).then(function(){s.clear()})},register:function(e,o){return n({url:t.apiPrefix+e,method:"POST",data:o}).then(function(t){return s.set("authToken",t.data.token),s.set("userRole","user"),s.setUser(t.data.user),t})},validateToken:function(e,o){return n({url:t.apiPrefix+e,method:"GET",headers:{"X-Auth-Token":o}}).then(function(t){return s.set("authToken",o),s.set("userRole","user"),s.setUser(t.data),t})},isAuthenticated:function(){return!!s.get("authToken")},isAuthorized:function(t){return angular.isArray(t)||(t=[t]),this.isAuthenticated()&&-1!==t.indexOf(s.get("userRole"))},getUser:function(){return s.getUser()},userRoles:e}}});var app=angular.module("rs-auth",[]).run(["$rsSession","AUTH_EVENTS","$timeout","$rootScope","$rsAuth",function(t,e,n,s,o,a,u){if(u.isAuthenticated())o(function(){a.$broadcast(e.loginSuccess)});else if(t.getLocalAuth()){var r=t.getLocalAuth();u.validateToken(r).then(function(){a.$broadcast(e.loginSuccess)})}a.$on("$stateChangeStart",function(t,n){var s={all:"*"};n.data.authorizedRoles&&(s=n.data.authorizedRoles),s[0]===u.userRoles.all||u.isAuthorized(s)||(t.preventDefault(),a.$broadcast(u.isAuthenticated()?e.notAuthorized:e.notAuthenticated))})}]),app=angular.module("rs-auth");app.service("$rsSession",["$window",function(t){this.set=function(e,n){t.sessionStorage.setItem(e,n)},this.get=function(e){return t.sessionStorage.getItem(e)},this.setUser=function(e){t.sessionStorage.setItem("user",JSON.stringify(e))},this.getUser=function(){return JSON.parse(t.sessionStorage.getItem("user"))},this.unset=function(e){t.sessionStorage.removeItem(e)},this.setLocalAuth=function(e){t.localStorage.setItem("authToken",e)},this.getLocalAuth=function(){return t.localStorage.getItem("authToken")},this.clear=function(){t.sessionStorage.clear(),t.localStorage.clear()}}]);