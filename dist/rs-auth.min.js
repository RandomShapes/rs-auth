!function(e){function t(t,n,o,u,i){function a(e){function a(t){e.remember&&n.localStorage.setItem("authToken",t.data.token),n.sessionStorage.setItem("authToken",t.data.token),o[r.user]=t.data.user,o.$broadcast(u.loginSuccess),c.resolve(t)}function s(e){console.error("rs-auth login failed",e),o.$broadcast(u.loginFailed),c.reject(e)}var c=i.defer();return t({url:r.authUrl+r.loginEndPoint,method:"POST",data:e}).then(a).catch(s),c.promise}function s(){function e(e){n.localStorage.clear(),n.sessionStorage.clear(),o[r.user]=null,o.$broadcast(u.logoutSuccess),s.resolve(e)}function a(e){console.error("rs-auth logout failed",e),s.reject(e)}var s=i.defer();return t({url:r.authUrl+r.logoutEndPoint,method:"GET",headers:{"X-Auth-Token":n.sessionStorage.getItem("authToken")}}).then(e).catch(a),s.promise}function c(e){function a(e){n.sessionStorage.setItem("authToken",e.data.token),o[r.user]=e.data.user,o.$broadcast(u.registerSuccess),c.resolve(e)}function s(e){console.error("rs-auth register failed",e),c.reject(e)}var c=i.defer();return t({url:r.authUrl+r.registerEndPoint,method:"POST",data:e}).then(a).catch(s),c.promise}function d(e){function u(t){n.sessionStorage.setItem("authToken",e),o[r.user]=t.data,s.resolve(t)}function a(e){console.error("rs-auth register failed",e),s.reject(e)}var s=i.defer();return t({url:r.authUrl+r.validateEndPoint,method:"GET",headers:{"X-Auth-Token":e}}).then(u).catch(a),s.promise}function l(t){e.isArray(t)||(t=[t]);var n=o[r.user].role||o[r.user].status;return-1!==t.indexOf(n)}function h(){return n.sessionStorage.getItem("authToken")}return{login:a,logout:s,register:c,validateToken:d,isAuthenticated:h,isAuthorized:l,isRemembered:h,getToken:h}}function n(){this.config=r,this.userRoles=u,this.setUserRoles=function(t){e.extend(u,t)},this.$get=function(e){return{login:function(t){return e.login(t)},logout:function(){return e.logout()},register:function(t){return e.register(t)},validateToken:function(t){return e.validateToken(t)},isAuthenticated:function(){return e.isAuthenticated()},isAuthorized:function(t){return e.isAuthorized(t)},isRemembered:function(){return e.isRemembered()},getToken:function(){return e.getToken()},userRoles:u}},this.$get.$inject=["Local"]}function o(e,t,n){function o(){var o;n.isAuthenticated()?(o=n.isAuthenticated(),n.validateToken(o).then(function(){t.$broadcast(e.loginSuccess)})):n.isRemembered()&&(o=n.isRemembered(),n.validateToken(o).then(function(){t.$broadcast(e.loginSuccess)}))}function u(e){for(var t in e)if("*"===e[t])return!0;return!1}function i(o,a){var s=a;if(t[r.user]){var c={all:"*"};s.data&&s.data.authorizedRoles&&(c=s.data.authorizedRoles),u(c)||n.isAuthorized(c)||!n.isAuthenticated()?u(c)||n.isAuthorized(c)||!n.isAuthenticated()||(o.preventDefault(),t.$broadcast(e.notAuthenticated)):(o.preventDefault(),t.$broadcast(e.notAuthorized))}else t.$on(e.loginSuccess,function(e){i(e,s)})}o(),t.$on("$stateChangeStart",function(e,t){i(e,t)})}e.module("rs-auth",[]).factory("Local",t).provider("$rsAuth",n).run(o);var r={authUrl:"",loginEndPoint:"/auth",registerEndPoint:"/register",validateEndPoint:"/auth",logoutEndPoint:"/logout",user:"currentUser"},u={all:"*"};e.module("rs-auth").constant("AUTH_EVENTS",{loginSuccess:"$authLoginSuccess",loginFailed:"$authLoginFailed",logoutSuccess:"$authLogoutSuccess",sessionTimeout:"$authSessionTimeout",notAuthenticated:"$authNotAuthenticated",notAuthorized:"$authNotAuthorized"}),t.$inject=["$http","$window","$rootScope","AUTH_EVENTS","$q"],o.$inject=["AUTH_EVENTS","$rootScope","$rsAuth"]}(angular);