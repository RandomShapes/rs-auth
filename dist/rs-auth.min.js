!function(t){function e(e,n,o){function u(t){function u(e){return t.remember&&n.localStorage.setItem("authToken",e.data.token),n.sessionStorage.setItem("authToken",e.data.token),o[r.user]=e.data.user,e}function i(t){console.error("rs-auth login failed",t)}return e({url:r.authUrl+r.loginEndPoint,method:"POST",data:t}).then(u).catch(i)}function i(){function t(){n.localStorage.clear(),n.sessionStorage.clear(),o[r.user]=null}function u(t){console.error("rs-auth logout failed",t)}return e({url:r.authUrl+r.logoutEndPoint,method:"GET",headers:{"X-Auth-Token":n.sessionStorage.getItem("authToken")}}).then(t).catch(u)}function a(t){function u(t){return n.sessionStorage.setItem("authToken",t.data.token),o[r.user]=t.data.user,t}function i(t){console.error("rs-auth register failed",t)}return e({url:r.authUrl+r.registerEndPoint,method:"POST",data:t}).then(u).catch(i)}function s(t){function u(e){return n.sessionStorage.setItem("authToken",t),o[r.user]=e.data,e}function i(t){console.error("rs-auth register failed",t)}return e({url:r.authUrl+r.validateEndPoint,method:"GET",headers:{"X-Auth-Token":t}}).then(u).catch(i)}function c(e){t.isArray(e)||(e=[e]);var n=o[r.user].role||o[r.user].status;return-1!==e.indexOf(n)}function d(){return n.sessionStorage.getItem("authToken")}return{login:u,logout:i,register:a,validateToken:s,isAuthenticated:d,isAuthorized:c,isRemembered:d,getToken:d}}function n(){this.config=r,this.userRoles=u,this.setUserRoles=function(e){t.extend(u,e)},this.$get=function(t){return{login:function(e){return t.login(e)},logout:function(){return t.logout()},register:function(e){return t.register(e)},validateToken:function(e){return t.validateToken(e)},isAuthenticated:function(){return t.isAuthenticated()},isAuthorized:function(e){return t.isAuthorized(e)},isRemembered:function(){return t.isRemembered()},getToken:function(){return t.getToken()},userRoles:u}},this.$get.$inject=["Local"]}function o(t,e,n){function o(){var o;n.isAuthenticated()?(o=n.isAuthenticated(),n.validateToken(o).then(function(){e.$broadcast(t.loginSuccess)})):n.isRemembered()&&(o=n.isRemembered(),n.validateToken(o).then(function(){e.$broadcast(t.loginSuccess)}))}function u(t){for(var e in t)if("*"===t[e])return!0;return!1}function i(o,a){var s=a;if(e[r.user]){var c={all:"*"};s.data&&s.data.authorizedRoles&&(c=s.data.authorizedRoles),u(c)||n.isAuthorized(c)||!n.isAuthenticated()?u(c)||n.isAuthorized(c)||!n.isAuthenticated()||(o.preventDefault(),e.$broadcast(t.notAuthenticated)):(o.preventDefault(),e.$broadcast(t.notAuthorized))}else e.$on(t.loginSuccess,function(t){i(t,s)})}o(),e.$on("$stateChangeStart",function(t,e){i(t,e)})}t.module("rs-auth",[]).factory("Local",e).provider("$rsAuth",n).run(o);var r={authUrl:"",loginEndPoint:"/auth",registerEndPoint:"/register",validateEndPoint:"/auth",logoutEndPoint:"/logout",user:"currentUser"},u={all:"*"};t.module("rs-auth").constant("AUTH_EVENTS",{loginSuccess:"$authLoginSuccess",loginFailed:"$authLoginFailed",logoutSuccess:"$authLogoutSuccess",sessionTimeout:"$authSessionTimeout",notAuthenticated:"$authNotAuthenticated",notAuthorized:"$authNotAuthorized"}),e.$inject=["$http","$window","$rootScope"],o.$inject=["AUTH_EVENTS","$rootScope","$rsAuth"]}(angular);