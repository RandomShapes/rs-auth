!function(t){function e(e,o,a,r,u,s){function i(t){function s(e){t.remember&&o.localStorage.setItem("authToken",e.data.token),o.sessionStorage.setItem("authToken",e.data.token),a[n.user]=e.data.user,a.$broadcast(r.loginSuccess),c.resolve(e)}function i(t){console.error("rs-auth login failed",t),a.$broadcast(r.loginFailed),c.reject(t.status+" - "+t.data.message)}var c=u.defer();return e({url:n.authUrl+n.loginEndPoint,method:"POST",data:t}).then(s).catch(i),c.promise}function c(){function t(t){o.localStorage.clear(),o.sessionStorage.clear(),a[n.user]=null,a.$broadcast(r.logoutSuccess),i.resolve(t)}function s(t){console.error("rs-auth logout failed",t),a.$broadcast(r.logoutFailed),i.reject(t.status+" - "+t.data.message)}var i=u.defer();return e({url:n.authUrl+n.logoutEndPoint,method:"GET",headers:{"X-Auth-Token":o.sessionStorage.getItem("authToken")}}).then(t).catch(s),i.promise}function d(t){function r(t){o.sessionStorage.setItem("authToken",t.data.token),a[n.user]=t.data.user,i.resolve(t)}function s(t){console.error("rs-auth register failed",t),i.reject(t.status+" - "+t.data.message)}var i=u.defer();return e({url:n.authUrl+n.registerEndPoint,method:"POST",data:t}).then(r).catch(s),i.promise}function l(t){function s(e){o.sessionStorage.setItem("authToken",t),a[n.user]=e.data,a.$broadcast(r.validateSuccess),c.resolve(e)}function i(t){console.error("rs-auth found the token to be invalid, deleting tokens",t),a.$broadcast(r.validateFailure),$(),c.reject(t.status+" - "+t.data.message)}var c=u.defer();return e({url:n.authUrl+n.validateEndPoint,method:"GET",headers:{"X-Auth-Token":t}}).then(s).catch(i),c.promise}function h(e){t.isArray(e)||(e=[e]);var o=a[n.user].role||a[n.user].status,r=-1!==e.indexOf(o);return r}function f(){var t=o.sessionStorage.getItem("authToken");return t}function g(){var t=o.localStorage.getItem("authToken");return t}function $(){s(function(){o.localStorage.clear(),o.sessionStorage.clear(),a[n.user]=null})}return{login:i,logout:c,register:d,validateToken:l,isAuthenticated:f,isAuthorized:h,isRemembered:g,getToken:f,destroyTokens:$}}function o(){this.config=n,this.userRoles=r,this.setUserRoles=function(e){t.extend(r,e)},this.$get=function(t,e,o){function a(t){e[n.user]?t(e[n.user]):e.$on(o.loginSuccess,function(){t(e[n.user])})}return{login:function(e){return t.login(e)},logout:function(){return t.logout()},register:function(e){return t.register(e)},validateToken:function(e){return t.validateToken(e)},isAuthenticated:function(){return t.isAuthenticated()},isAuthorized:function(e){return t.isAuthorized(e)},isRemembered:function(){return t.isRemembered()},getToken:function(){return t.getToken()},destroyTokens:function(){return t.destroyTokens()},currentUser:a,userRoles:r}},this.$get.$inject=["Local","$rootScope","AUTH_EVENTS"]}function a(t,e,o,a,r){function u(){var a;o.isAuthenticated()?(a=o.isAuthenticated(),o.validateToken(a).then(function(){e.$broadcast(t.authSuccess)},function(){e.$broadcast(t.authFailed)})):o.isRemembered()?(a=o.isRemembered(),o.validateToken(a).then(function(){e.$broadcast(t.authSuccess)},function(){e.$broadcast(t.authFailed)})):r(function(){e.$broadcast(t.notAuthenticated),e.$broadcast(t.authFailed)})}function s(t){for(var e in t)if("*"===t[e])return!0;return!1}function i(r,u,i,c,d){var l={all:"*"};u.data&&u.data.authorizedRoles&&(l=u.data.authorizedRoles),s(l)||(o.isAuthenticated()?o.isAuthenticated&&!e[n.user]?(r.preventDefault(),o.validateToken(o.isAuthenticated()),e.$on(t.validateSuccess,function(){a.go(u.name,i)}),e.$on(t.validateFailure,function(){e.$broadcast(t.authFailed)})):o.isAuthenticated&&e[n.user]&&!o.isAuthorized(l)?(r.preventDefault(),e.$broadcast(t.notAuthorized,c)):e.$broadcast(t.authSuccess):(r.preventDefault(),e.$broadcast(t.notAuthenticated,c,d)))}u(),e.$on("$stateChangeStart",function(t,e,o,a,n){i(t,e,o,a,n)})}t.module("rs-auth",[]).factory("Local",e).provider("$rsAuth",o).run(a);var n={authUrl:"",loginEndPoint:"/auth",registerEndPoint:"/register",validateEndPoint:"/auth",logoutEndPoint:"/logout",user:"currentUser"},r={all:"*"};t.module("rs-auth").constant("AUTH_EVENTS",{loginSuccess:"$authLoginSuccess",loginFailed:"$authLoginFailed",logoutSuccess:"$authLogoutSuccess",logoutFailed:"$authLogoutFailed",sessionTimeout:"$authSessionTimeout",notAuthenticated:"$authNotAuthenticated",notAuthorized:"$authNotAuthorized",authSuccess:"$authAuthSuccess",authFailed:"$authAuthFailed",validateSuccess:"$authValidateSuccess",validateFailed:"$authValidateFailed",clearLoader:"$authClearLoader"}),e.$inject=["$http","$window","$rootScope","AUTH_EVENTS","$q","$timeout"],a.$inject=["AUTH_EVENTS","$rootScope","$rsAuth","$state","$timeout"]}(angular);