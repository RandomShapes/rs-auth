!function(e){function t(t,o,n,r,u){function i(e){function i(t){e.remember&&o.localStorage.setItem("authToken",t.data.token),o.sessionStorage.setItem("authToken",t.data.token),n[a.user]=t.data.user,n.$broadcast(r.loginSuccess),c.resolve(t)}function s(e){console.error("rs-auth login failed",e),n.$broadcast(r.loginFailed),c.reject(e)}var c=u.defer();return t({url:a.authUrl+a.loginEndPoint,method:"POST",data:e}).then(i).catch(s),c.promise}function s(){function e(e){o.localStorage.clear(),o.sessionStorage.clear(),n[a.user]=null,n.$broadcast(r.logoutSuccess),s.resolve(e)}function i(e){console.error("rs-auth logout failed",e),n.$broadcast(r.logoutFailed),s.reject(e)}var s=u.defer();return t({url:a.authUrl+a.logoutEndPoint,method:"GET",headers:{"X-Auth-Token":o.sessionStorage.getItem("authToken")}}).then(e).catch(i),s.promise}function c(e){function r(e){o.sessionStorage.setItem("authToken",e.data.token),n[a.user]=e.data.user,s.resolve(e)}function i(e){console.error("rs-auth register failed",e),s.reject(e)}var s=u.defer();return t({url:a.authUrl+a.registerEndPoint,method:"POST",data:e}).then(r).catch(i),s.promise}function d(e){function i(t){o.sessionStorage.setItem("authToken",e),n[a.user]=t.data,n.$broadcast(r.validateSuccess),c.resolve(t)}function s(e){console.error("rs-auth found the token to be invalid, deleting tokens",e),n.$broadcast(r.validateFailure),g(),c.reject(e)}var c=u.defer();return t({url:a.authUrl+a.validateEndPoint,method:"GET",headers:{"X-Auth-Token":e}}).then(i).catch(s),c.promise}function l(t){e.isArray(t)||(t=[t]);var o=n[a.user].role||n[a.user].status,r=-1!==t.indexOf(o);return r}function h(){var e=o.sessionStorage.getItem("authToken");return e}function f(){var e=o.localStorage.getItem("authToken");return e}function g(){o.localStorage.clear(),o.sessionStorage.clear(),n[a.user]=null}return{login:i,logout:s,register:c,validateToken:d,isAuthenticated:h,isAuthorized:l,isRemembered:f,getToken:h,destroyTokens:g}}function o(){this.config=a,this.userRoles=r,this.setUserRoles=function(t){e.extend(r,t)},this.$get=function(e,t,o){function n(e){t[a.user]?e(t[a.user]):t.$on(o.loginSuccess,function(){e(t[a.user])})}return{login:function(t){return e.login(t)},logout:function(){return e.logout()},register:function(t){return e.register(t)},validateToken:function(t){return e.validateToken(t)},isAuthenticated:function(){return e.isAuthenticated()},isAuthorized:function(t){return e.isAuthorized(t)},isRemembered:function(){return e.isRemembered()},getToken:function(){return e.getToken()},destroyTokens:function(){return e.destroyTokens()},currentUser:n,userRoles:r}},this.$get.$inject=["Local","$rootScope","AUTH_EVENTS"]}function n(e,t,o,n,r){function u(){var n;o.isAuthenticated()?(n=o.isAuthenticated(),o.validateToken(n).then(function(){t.$broadcast(e.authSuccess)})):o.isRemembered()?(n=o.isRemembered(),o.validateToken(n).then(function(){t.$broadcast(e.authSuccess)})):r(function(){t.$broadcast(e.notAuthenticated),t.$broadcast(e.authFailed)})}function i(e){for(var t in e)if("*"===e[t])return!0;return!1}function s(r,u,s,c,d){var l={all:"*"};if(u.data&&u.data.authorizedRoles&&(l=u.data.authorizedRoles),!i(l))if(o.isAuthenticated())if(o.isAuthenticated&&!t[a.user]){r.preventDefault(),t.$broadcast(e.notAuthenticated,c,d);var h=setTimeout(function(){t.$broadcast(e.authFailed)},1e3);t.$on(e.loginSuccess,function(){clearTimeout(h),n.go(u.name,s)})}else o.isAuthenticated&&t[a.user]&&!o.isAuthorized(l)?(r.preventDefault(),t.$broadcast(e.notAuthorized,c)):t.$broadcast(e.authSuccess);else r.preventDefault(),t.$broadcast(e.notAuthenticated,c,d)}u(),t.$on("$stateChangeStart",function(e,t,o,n,a){s(e,t,o,n,a)})}e.module("rs-auth",[]).factory("Local",t).provider("$rsAuth",o).run(n);var a={authUrl:"",loginEndPoint:"/auth",registerEndPoint:"/register",validateEndPoint:"/auth",logoutEndPoint:"/logout",user:"currentUser"},r={all:"*"};e.module("rs-auth").constant("AUTH_EVENTS",{loginSuccess:"$authLoginSuccess",loginFailed:"$authLoginFailed",logoutSuccess:"$authLogoutSuccess",logoutFailed:"$authLogoutFailed",sessionTimeout:"$authSessionTimeout",notAuthenticated:"$authNotAuthenticated",notAuthorized:"$authNotAuthorized",authSuccess:"$authAuthSuccess",authFailed:"$authAuthFailed",validateSuccess:"$authValidateSuccess",validateFailed:"$authValidateFailed",clearLoader:"$authClearLoader"}),t.$inject=["$http","$window","$rootScope","AUTH_EVENTS","$q"],n.$inject=["AUTH_EVENTS","$rootScope","$rsAuth","$state","$timeout"]}(angular);